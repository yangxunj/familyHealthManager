# 家庭健康管理平台 - 项目总计划

> 本文档记录家庭健康管理平台的整体开发计划。
>
> 产品设计参考：`doc/design/product-design.md`
>
> 技术架构参考：`doc/design/technical-architecture.md`

---

## 项目概述

### 产品简介

家庭健康管理平台是一个面向家庭用户的健康数据管理工具，核心功能包括：
- 家庭成员健康档案管理
- 健康文档（体检报告等）上传与管理
- 健康指标记录与趋势追踪
- AI健康建议生成
- AI健康咨询对话

### 技术栈

| 层次 | 技术 |
|------|------|
| 前端 | React + Vite + Ant Design + Zustand |
| 后端 | NestJS + Prisma |
| 数据库 | PostgreSQL |
| AI服务 | 阿里云DashScope (通义千问) |

### 核心功能模块

| 模块 | 状态 | 说明 |
|------|------|------|
| 用户认证 | ⏳ 待开发 | 注册、登录、Token管理 |
| 家庭成员管理 | ⏳ 待开发 | 成员CRUD、健康概览 |
| 健康文档管理 | ⏳ 待开发 | 文档上传、预览、管理 |
| 健康记录管理 | ⏳ 待开发 | 指标记录、趋势图表 |
| AI健康建议 | ⏳ 待开发 | 个性化健康建议生成 |
| AI健康咨询 | ⏳ 待开发 | 流式对话、上下文管理 |

---

## 第一阶段：项目初始化与基础架构

**目标**: 搭建项目基础架构，完成数据库设计和基础模块

**状态**: ⏳ 待开发

### 任务清单

- [ ] **1.1 项目初始化**
  - [ ] 1.1.1 创建后端项目 (NestJS)
  - [ ] 1.1.2 创建前端项目 (Vite + React)
  - [ ] 1.1.3 配置 TypeScript、ESLint、Prettier
  - [ ] 1.1.4 配置 Git 和 .gitignore

- [ ] **1.2 数据库设计与初始化**
  - [ ] 1.2.1 配置 Prisma 连接 PostgreSQL
  - [ ] 1.2.2 创建 Prisma Schema（所有数据模型）
  - [ ] 1.2.3 执行数据库迁移
  - [ ] 1.2.4 编写种子数据脚本

- [ ] **1.3 后端基础架构**
  - [ ] 1.3.1 配置 NestJS 全局管道和过滤器
  - [ ] 1.3.2 创建 Prisma 模块和服务
  - [ ] 1.3.3 配置环境变量管理
  - [ ] 1.3.4 配置 CORS 和安全中间件

- [ ] **1.4 前端基础架构**
  - [ ] 1.4.1 配置 Ant Design 和主题
  - [ ] 1.4.2 配置路由 (React Router)
  - [ ] 1.4.3 配置 Axios 和 React Query
  - [ ] 1.4.4 创建基础布局组件

**验收标准**:
- [ ] 后端服务可启动，访问健康检查接口返回正常
- [ ] 前端应用可启动，显示基础布局
- [ ] 数据库迁移成功，表结构正确
- [ ] 代码规范检查通过

---

## 第二阶段：用户认证模块

**目标**: 完成用户注册、登录、Token管理功能

**状态**: ⏳ 待开发

### 任务清单

- [ ] **2.1 后端认证模块**
  - [ ] 2.1.1 创建 auth 模块结构
  - [ ] 2.1.2 实现用户注册接口（密码加密）
  - [ ] 2.1.3 实现用户登录接口（JWT生成）
  - [ ] 2.1.4 实现 Token 刷新接口
  - [ ] 2.1.5 实现 JWT 策略和守卫
  - [ ] 2.1.6 创建 @CurrentUser 装饰器

- [ ] **2.2 后端用户模块**
  - [ ] 2.2.1 创建 users 模块结构
  - [ ] 2.2.2 实现获取当前用户信息接口
  - [ ] 2.2.3 实现更新用户信息接口
  - [ ] 2.2.4 实现修改密码接口

- [ ] **2.3 前端认证页面**
  - [ ] 2.3.1 创建登录页面
  - [ ] 2.3.2 创建注册页面
  - [ ] 2.3.3 实现 Token 存储和自动刷新
  - [ ] 2.3.4 实现路由守卫（未登录跳转）
  - [ ] 2.3.5 创建用户状态管理 (Zustand)

**验收标准**:
- [ ] 用户可以注册新账号
- [ ] 用户可以登录并获取 Token
- [ ] Token 过期后可自动刷新
- [ ] 未登录用户被正确拦截

---

## 第三阶段：家庭成员管理

**目标**: 完成家庭成员的CRUD功能和健康概览

**状态**: ⏳ 待开发

### 任务清单

- [ ] **3.1 后端成员模块**
  - [ ] 3.1.1 创建 members 模块结构
  - [ ] 3.1.2 实现成员列表接口
  - [ ] 3.1.3 实现创建成员接口（含"本人"验证）
  - [ ] 3.1.4 实现获取成员详情接口（含健康概览）
  - [ ] 3.1.5 实现更新成员接口
  - [ ] 3.1.6 实现删除成员接口（软删除）
  - [ ] 3.1.7 实现成员归属验证服务

- [ ] **3.2 前端成员页面**
  - [ ] 3.2.1 创建首页仪表盘（成员卡片展示）
  - [ ] 3.2.2 创建成员列表页面
  - [ ] 3.2.3 创建添加成员页面/弹窗
  - [ ] 3.2.4 创建成员详情页面
  - [ ] 3.2.5 创建编辑成员页面
  - [ ] 3.2.6 实现成员删除确认
  - [ ] 3.2.7 创建成员状态管理

**验收标准**:
- [ ] 新用户首次登录被引导创建"本人"档案
- [ ] 可以添加、编辑、删除家庭成员
- [ ] 成员详情页显示健康概览信息
- [ ] 首页正确展示所有家庭成员卡片

---

## 第四阶段：健康文档管理

**目标**: 完成健康文档（体检报告等）的上传和管理

**状态**: ⏳ 待开发

### 任务清单

- [ ] **4.1 后端文件存储**
  - [ ] 4.1.1 创建 storage 模块
  - [ ] 4.1.2 实现本地文件存储服务
  - [ ] 4.1.3 实现文件上传接口
  - [ ] 4.1.4 配置文件类型和大小限制

- [ ] **4.2 后端文档模块**
  - [ ] 4.2.1 创建 documents 模块结构
  - [ ] 4.2.2 实现文档上传接口（含文件）
  - [ ] 4.2.3 实现文档列表接口（支持筛选）
  - [ ] 4.2.4 实现文档详情接口
  - [ ] 4.2.5 实现文档删除接口

- [ ] **4.3 前端文档页面**
  - [ ] 4.3.1 创建文档列表页面（含筛选）
  - [ ] 4.3.2 创建文档上传页面/弹窗
  - [ ] 4.3.3 实现多文件上传组件
  - [ ] 4.3.4 创建文档详情页面
  - [ ] 4.3.5 实现图片预览组件
  - [ ] 4.3.6 实现 PDF 预览组件

**验收标准**:
- [ ] 可以上传体检报告等健康文档（支持图片、PDF）
- [ ] 文档列表支持按成员、类型、时间筛选
- [ ] 可以预览已上传的文档
- [ ] 可以删除不需要的文档

---

## 第五阶段：健康记录管理

**目标**: 完成健康指标的记录和趋势图表展示

**状态**: ⏳ 待开发

### 任务清单

- [ ] **5.1 后端记录模块**
  - [ ] 5.1.1 创建 records 模块结构
  - [ ] 5.1.2 实现健康指标参考范围配置
  - [ ] 5.1.3 实现添加记录接口（含异常值判断）
  - [ ] 5.1.4 实现记录列表接口
  - [ ] 5.1.5 实现趋势数据接口
  - [ ] 5.1.6 实现删除记录接口

- [ ] **5.2 前端记录页面**
  - [ ] 5.2.1 创建记录列表页面
  - [ ] 5.2.2 创建添加记录页面（多指标同时录入）
  - [ ] 5.2.3 创建趋势图表页面
  - [ ] 5.2.4 实现折线图组件（ECharts）
  - [ ] 5.2.5 实现异常值高亮显示
  - [ ] 5.2.6 实现时间范围切换

**验收标准**:
- [ ] 可以录入血压、血糖、体重等健康指标
- [ ] 异常值被正确识别和标记
- [ ] 趋势图表正确展示历史数据变化
- [ ] 支持按时间范围查看趋势

---

## 第六阶段：AI健康建议

**目标**: 完成AI分析健康数据并生成个性化建议

**状态**: ⏳ 待开发

### 任务清单

- [ ] **6.1 后端AI服务**
  - [ ] 6.1.1 创建 ai 模块结构
  - [ ] 6.1.2 实现 DashScope API 封装
  - [ ] 6.1.3 配置健康建议 Prompt 模板

- [ ] **6.2 后端建议模块**
  - [ ] 6.2.1 创建 advice 模块结构
  - [ ] 6.2.2 实现数据收集服务（汇总成员健康数据）
  - [ ] 6.2.3 实现建议生成接口
  - [ ] 6.2.4 实现建议解析和存储
  - [ ] 6.2.5 实现历史建议查询接口

- [ ] **6.3 前端建议页面**
  - [ ] 6.3.1 创建AI建议页面
  - [ ] 6.3.2 实现建议报告展示组件
  - [ ] 6.3.3 实现健康评分展示
  - [ ] 6.3.4 实现优先事项列表
  - [ ] 6.3.5 实现行动清单（可勾选）
  - [ ] 6.3.6 添加免责声明展示

**验收标准**:
- [ ] 可以为家庭成员生成AI健康建议
- [ ] 建议内容结构完整（评分、关注事项、建议、行动清单）
- [ ] 数据不足时有合适的提示
- [ ] 明确展示AI建议的免责声明

---

## 第七阶段：AI健康咨询对话

**目标**: 完成与AI的流式健康咨询对话功能

**状态**: ⏳ 待开发

### 任务清单

- [ ] **7.1 后端对话模块**
  - [ ] 7.1.1 创建 chat 模块结构
  - [ ] 7.1.2 实现对话上下文构建服务
  - [ ] 7.1.3 实现创建会话接口
  - [ ] 7.1.4 实现获取会话列表接口
  - [ ] 7.1.5 实现获取会话消息接口
  - [ ] 7.1.6 实现流式消息接口（SSE）
  - [ ] 7.1.7 实现删除会话接口
  - [ ] 7.1.8 配置对话 Prompt 模板

- [ ] **7.2 前端对话页面**
  - [ ] 7.2.1 创建会话列表页面
  - [ ] 7.2.2 创建对话页面
  - [ ] 7.2.3 实现消息气泡组件
  - [ ] 7.2.4 实现流式消息接收和展示
  - [ ] 7.2.5 实现快捷问题入口
  - [ ] 7.2.6 实现成员选择器
  - [ ] 7.2.7 实现会话管理（删除、新建）

**验收标准**:
- [ ] 可以选择家庭成员并开始对话
- [ ] AI回复实时流式展示
- [ ] 对话可以访问成员的健康数据上下文
- [ ] 会话记录正确保存和展示

---

## 第八阶段：优化与测试

**目标**: 性能优化、安全加固和全面测试

**状态**: ⏳ 待开发

### 任务清单

- [ ] **8.1 后端优化**
  - [ ] 8.1.1 添加数据库索引优化
  - [ ] 8.1.2 实现关键接口缓存
  - [ ] 8.1.3 添加请求限流
  - [ ] 8.1.4 完善错误处理和日志

- [ ] **8.2 安全加固**
  - [ ] 8.2.1 敏感数据加密存储
  - [ ] 8.2.2 添加输入验证和XSS防护
  - [ ] 8.2.3 添加操作审计日志
  - [ ] 8.2.4 安全依赖检查

- [ ] **8.3 测试**
  - [ ] 8.3.1 编写后端单元测试
  - [ ] 8.3.2 编写后端集成测试
  - [ ] 8.3.3 编写前端组件测试
  - [ ] 8.3.4 执行全流程E2E测试
  - [ ] 8.3.5 修复发现的问题

- [ ] **8.4 文档完善**
  - [ ] 8.4.1 更新 API 文档
  - [ ] 8.4.2 编写部署文档
  - [ ] 8.4.3 编写用户使用指南

**验收标准**:
- [ ] 核心功能测试覆盖率 > 80%
- [ ] 无重大安全漏洞
- [ ] 主要操作响应时间 < 500ms
- [ ] 文档完整可用

---

## 第九阶段：部署上线

**目标**: 完成生产环境部署准备

**状态**: ⏳ 待开发

### 任务清单

- [ ] **9.1 部署准备**
  - [ ] 9.1.1 编写 Dockerfile（前端、后端）
  - [ ] 9.1.2 编写 docker-compose 配置
  - [ ] 9.1.3 配置 Nginx 反向代理
  - [ ] 9.1.4 准备生产环境配置

- [ ] **9.2 CI/CD**
  - [ ] 9.2.1 配置自动化构建
  - [ ] 9.2.2 配置自动化测试
  - [ ] 9.2.3 配置自动化部署

- [ ] **9.3 监控**
  - [ ] 9.3.1 配置健康检查
  - [ ] 9.3.2 配置错误告警
  - [ ] 9.3.3 配置性能监控

**验收标准**:
- [ ] 可以一键部署到生产环境
- [ ] 健康检查正常
- [ ] 监控告警正常工作

---

## 里程碑

| 里程碑 | 内容 | 依赖 | 状态 |
|--------|------|------|------|
| M1 | 项目基础架构完成 | - | ⏳ |
| M2 | 用户认证功能可用 | M1 | ⏳ |
| M3 | 家庭成员管理可用 | M2 | ⏳ |
| M4 | 健康文档管理可用 | M3 | ⏳ |
| M5 | 健康记录和趋势可用 | M3 | ⏳ |
| M6 | AI健康建议可用 | M4, M5 | ⏳ |
| M7 | AI健康咨询可用 | M6 | ⏳ |
| M8 | 测试与优化完成 | M7 | ⏳ |
| M9 | 生产环境部署就绪 | M8 | ⏳ |

---

## 更新记录

| 日期 | 更新内容 |
|------|----------|
| 2026-01-21 | 创建项目总计划 |
